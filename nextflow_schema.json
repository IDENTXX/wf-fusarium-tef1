{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://raw.githubusercontent.com/IDENTXX/wf-fusarium-tef1/main/nextflow_schema.json",
  "title": "IDENTXX/wf-fusarium-tef1",
  "workflow_title": "Fusarium TEF1 metabarcoding",
  "description": "Primer trimming -> filtering -> clustering -> BLAST vs TEF1 reference -> tables + HTML report.",
  "url": "https://github.com/IDENTXX/wf-fusarium-tef1",
  "type": "object",

  "definitions": {
    "input": {
      "title": "Input Options",
      "type": "object",
      "fa_icon": "fas fa-arrow-right",
      "properties": {
        "reads": {
          "type": "string",
          "format": "path",
          "title": "Reads root directory",
          "description": "Directory with one level of sample/barcode subfolders containing FASTQ.gz files.",
          "help_text": "Example: READS_ROOT/Sample_01/*.fastq.gz"
        },
        "db_fasta": {
          "type": "string",
          "format": "file-path",
          "title": "TEF1 reference FASTA",
          "description": "FASTA used to build the BLAST database (TEF1 reference set)."
        }
      },
      "required": ["reads", "db_fasta"]
    },

    "primer": {
      "title": "Primer Options",
      "type": "object",
      "fa_icon": "fas fa-cut",
      "properties": {
        "primer_fwd": {
          "type": "string",
          "title": "Forward primer",
          "default": "",
          "description": "If empty (or reverse empty), primer trimming is skipped."
        },
        "primer_rev": {
          "type": "string",
          "title": "Reverse primer",
          "default": "",
          "description": "If empty (or forward empty), primer trimming is skipped."
        },
        "require_primers": {
          "type": "boolean",
          "title": "Discard reads without primer match",
          "default": true
        },
        "trim_error_rate": {
          "type": "number",
          "title": "Cutadapt error rate",
          "default": 0.12,
          "minimum": 0.0,
          "maximum": 0.3
        }
      }
    },

    "filter": {
      "title": "Filtering Options",
      "type": "object",
      "fa_icon": "fas fa-filter",
      "properties": {
        "min_q": {
          "type": "integer",
          "title": "Minimum Q-score",
          "default": 9,
          "minimum": 0,
          "maximum": 30
        },
        "min_len": {
          "type": "integer",
          "title": "Minimum length",
          "default": 300,
          "minimum": 1
        },
        "max_len": {
          "type": "integer",
          "title": "Maximum length",
          "default": 1200,
          "minimum": 1
        }
      }
    },

    "clustering": {
      "title": "Clustering Options",
      "type": "object",
      "fa_icon": "fas fa-project-diagram",
      "properties": {
        "cluster_id": {
          "type": "number",
          "title": "Clustering identity (VSEARCH)",
          "default": 0.9,
          "minimum": 0.5,
          "maximum": 1.0
        },
        "min_cluster_reads": {
          "type": "integer",
          "title": "Minimum reads per cluster",
          "default": 20,
          "minimum": 1
        }
      }
    },

    "blast": {
      "title": "BLAST Options",
      "type": "object",
      "fa_icon": "fas fa-search",
      "properties": {
        "blast_topn": {
          "type": "integer",
          "title": "BLAST max targets per query",
          "default": 5,
          "minimum": 1,
          "maximum": 50
        }
      }
    },

    "output": {
      "title": "Output Options",
      "type": "object",
      "fa_icon": "fas fa-folder-open",
      "properties": {
        "out_dir": {
          "type": "string",
          "format": "path",
          "title": "Output directory",
          "default": "output"
        }
      }
    }
  },

  "allOf": [
    { "$ref": "#/definitions/input" },
    { "$ref": "#/definitions/primer" },
    { "$ref": "#/definitions/filter" },
    { "$ref": "#/definitions/clustering" },
    { "$ref": "#/definitions/blast" },
    { "$ref": "#/definitions/output" }
  ]
}
